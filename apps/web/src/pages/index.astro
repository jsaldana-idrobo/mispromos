---
import BaseLayout from "../layouts/BaseLayout.astro";

const { searchParams } = new URL(Astro.request.url);
const city = searchParams.get("city") ?? "";
const at = searchParams.get("at") ?? "";
---

<BaseLayout title="Mis promos | Promos activas">
  <section class="grid gap-6" data-redeploy="1">
    <div class="glass-panel rounded-3xl p-6">
      <div class="grid gap-2">
        <h1 class="text-3xl font-display">Promociones activas</h1>
        <p class="text-sm text-ink-900/60">
          Explora promociones en tiempo real. Usa los filtros para afinar la búsqueda.
        </p>
      </div>
      <form class="mt-6 grid gap-4" data-promos-form>
        <div class="flex flex-wrap items-end gap-3">
          <label class="flex min-w-[160px] flex-1 flex-col gap-2 text-sm font-semibold">
            Ciudad
            <select class="input-field" name="city" data-city-select data-initial-city={city}>
              <option value="">Todas</option>
            </select>
          </label>
          <label class="flex min-w-[160px] flex-1 flex-col gap-2 text-sm font-semibold">
            Categoría
            <select class="input-field" name="category" data-category-select>
              <option value="">Todas</option>
            </select>
          </label>
          <label class="flex min-w-[160px] flex-1 flex-col gap-2 text-sm font-semibold">
            Tipo de promo
            <select class="input-field" name="promoType">
              <option value="">Todas</option>
              <option value="discount">Descuento</option>
              <option value="2x1">2x1</option>
              <option value="combo">Combo</option>
              <option value="other">Otra</option>
            </select>
          </label>
          <label class="flex min-w-[160px] flex-1 flex-col gap-2 text-sm font-semibold">
            Buscar
            <input class="input-field" name="q" placeholder="2x1, combo, hamburguesa" />
          </label>
          <label class="flex min-w-[160px] flex-1 flex-col gap-2 text-sm font-semibold">
            Fecha y hora
            <input class="input-field" type="datetime-local" name="at" value={at} />
          </label>
          <button class="button-primary w-full sm:w-auto" type="submit">Aplicar filtros</button>
        </div>
      </form>
    </div>
    <div class="rounded-3xl border border-ink-900/10 bg-white/70 p-6">
      <div class="flex flex-wrap items-center justify-between gap-3">
        <div>
          <h2 class="text-lg font-semibold">Resultados</h2>
          <p class="mt-1 text-sm text-ink-900/60">
            Promociones activas de negocios locales y sus sedes.
          </p>
        </div>
        <p class="text-sm text-ink-900/60" data-promos-counter></p>
      </div>
      <div class="mt-6 grid gap-4" data-promos-container>
        <div class="rounded-2xl border border-ink-900/10 bg-sand-100 px-4 py-3 text-sm text-ink-900/70">
          Cargando promociones activas...
        </div>
      </div>
      <div class="mt-6 text-center text-sm text-ink-900/60" data-promos-load-more></div>
    </div>
  </section>

  <script type="module" src="/promos.js"></script>
</BaseLayout>
